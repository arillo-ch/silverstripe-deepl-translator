(()=>{var n="",o="Es gibt ungespeicherte \xC4nderungen am Glossar. Seite dennoch verlassen?",d=a=>(a.preventDefault(),a.returnValue=o),l=a=>({...a,newEntry:null,glossaryEntries:[],glossaryEntriesForTable:[],search:n,isLoading:!0,isFirstLoad:!0,sorter:{field:null,dir:"ASC"},isDirty:!1,init(){o=this.isDirtMessage||o,this.$watch("glossaryEntries",()=>{this.computeGlossaryEntriesForTable(),this.$nextTick(()=>{this.isFirstLoad||(this.isDirty=!0)})}),this.$watch("isDirty",e=>{e?window.addEventListener("beforeunload",d):(console.log("remove beforeunload"),window.removeEventListener("beforeunload",d))}),this.$watch("sorter",()=>this.computeGlossaryEntriesForTable()),this.$watch("search",()=>this.computeGlossaryEntriesForTable()),this.fetchGlossaryEntries(),this.sorter={field:this.locales.find(e=>e.IsGlobalDefault==!0).Lang,dir:"ASC"}},async fetchGlossaryEntries(){this.isLoading=!0,fetch(this.apiUrl("glossaryEntries"),{method:"get"}).then(async e=>{let s=await e.json();if(!e.ok){let t=s?.message||e.status;return Promise.reject(t)}this.prepareGlossaryEntries(s),this.setupNewEntry(),this.isLoading=!1,setTimeout(()=>this.isFirstLoad=!1,100)}).catch(e=>{alert(e.message||e)})},prepareGlossaryEntries(e){this.glossaryEntries=e.map(s=>({...s,id:this.generateId(),isNew:!1}))},setupNewEntry(){let e={};this.locales.forEach(s=>{e[s.Lang]=""}),this.newEntry=e},createNewEntry(){let e={...this.newEntry,id:this.generateId(),isNew:!0};this.glossaryEntries.push(e),this.setupNewEntry()},isNewEntryValid(){return Object.keys(this.newEntry).reduce((e,s)=>e&&this.newEntry[s]===n?!1:e,!0)},generateId(){return typeof crypto>"u"?"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let s=Math.random()*16|0;return(e=="x"?s:s&3|8).toString(16)}):crypto.randomUUID()},computeGlossaryEntriesForTable(){let e=this.locales.map(({Lang:t})=>t),s=this.search.toLowerCase();this.glossaryEntriesForTable=[...this.glossaryEntries.filter(t=>e.reduce((r,i)=>!r&&t[i]&&t[i]!==n&&t[i].toLowerCase().includes(s)?!0:r,!1)).sort((t,r)=>{let i=t[this.sorter.field].toLowerCase(),h=r[this.sorter.field].toLowerCase();return i>h?this.sorter.dir=="ASC"?1:-1:i<h?this.sorter.dir=="ASC"?-1:1:0})]},sorterBy(e){this.sorter.field===e?this.sorter.dir=this.sorter.dir=="ASC"?"DESC":"ASC":this.sorter={field:e,dir:"ASC"}},async saveGlossaries(){this.isLoading=!0;let e=new FormData;e.append("glossaryEntries",JSON.stringify(this.glossaryEntries)),fetch(this.apiUrl("saveGlossaries"),{method:"post",body:e}).then(async s=>{let t=await s.json();if(!s.ok){let r=t?.message||s.status;return Promise.reject(r)}this.prepareGlossaryEntries(t.glossaryEntries),this.setupNewEntry(),this.isDirty=!1}).catch(s=>{alert(s.message||s)}).finally(()=>this.isLoading=!1)},removeEntry(e){this.glossaryEntries=[...this.glossaryEntries.filter(s=>s.id!==e)]},apiUrl(e=null){return e?`${this.apiBase}${e}`:this.apiBase}});typeof Alpine<"u"&&Alpine.data("multiselectfield",l);document.addEventListener("alpine:init",()=>{Alpine.data("multiselectfield",l)});})();
